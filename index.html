<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Da Casino</title>
	<script type="text/javascript" src="js/phaser.js"></script>
	<script type="text/javascript" src="js/Card.js"></script>
	<script type="text/javascript" src="js/Deck.js"></script>
	<script type="text/javascript" src="js/Poker.js"></script>
	<script type="text/javascript" src="js/Paigow.js"></script>
	<script type="text/javascript" src="js/Hand.js"></script>
	

	<style type="text/css">
		body {
			margin: 0;
			background-color: #AA8639;
		}
		input {
			text-align: center;
			width: 50px;
		}
	</style>
</head>

<body>

<script>
	/******************************************************************************************************************************************
		GLOBAL STUFF
	******************************************************************************************************************************************/
	var game = new Phaser.Game(1550,5300,Phaser.CANVAS, 'gamebox', { preload: preload, create: create, update: update, render: render }, true);

	/*
	game.stage.scale.startFullScreen();
	game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
	game.stage.scale.setShowAll();
	game.scale.minWidth = 320;
	game.scale.minHeight = 480;
	game.scale.maxWidth = 768;
	game.scale.maxHeight = 1152;
	game.scale.refresh();
	*/
	// debug hand creator
	var DEBUG_COUNT = 25;
	var DEBUG_MAIN = 'random';
	var DEBUG_SUB = 'random';
	var DEBUG_JOKER = 50;
	/*
		color scheme - brown
	*/
	// background-color: #AA8639;
	// button background
	var BTN_BG = 0x85631C;
	// button text
	var BTN_TXT = '#F4D38D';
	// information background
	var INFO_BG = 0x604409;
	// information text
	var INFO_TXT = '#F4D38D';

	// initial hand position
	var HAND_X = 5;
	var HAND_Y = 280;
	var BANK_X = 5;
	var BANK_Y = 670;
	
	// type of game to run
	var game_mode;
	// level complete
	var game_level_complete = false;
	// main level group (ie pairs / trips)
	var game_learn_main_level;
	// sub level group (ie no-pair / joker+trips)
	var game_learn_sub_level;

	// object containing cards
	var deck;
	
	// game start button
	var btn_start;
	// next hand button
	var btn_next;
	
	// text box for main information
	var main_info_box;
	// text box for game information
	var main_info_box;
	// text box for hand information
	var hand_info_box;
	// text box for clock information
	var clock_info_box;
	// text box for stat information
	var stat_info_box;

	// clock stuff
	var clock;
	var clockEvent;
	
	/*
		stat stuff
	*/
	// total hand count
	var hand_count;
	// hand tries
	var hand_tries;

	// information about a hand
	var hand;
	// array containing chosen hair cards
	var hair_chosen;
	
	// group containing just cards
	var group_cards;
	// group containing the learn buttons
	var group_buttons_level;
	// group containing the compare buttons
	var group_buttons_compare;
	// group containing debug stuff
	var group_debug;

	/******************************************************************************************************************************************
		PRELOAD
	******************************************************************************************************************************************/
	function preload() {
		game.load.atlas('cards', 'assets/full-deck-with-joker.png','assets/full-deck-with-joker.json');
	}
	/******************************************************************************************************************************************
		CREATE
	******************************************************************************************************************************************/
	function create() {
		this.scale.scaleMode = Phaser.ScaleManager.AUTO;
		this.scale.pageAlignHorizontally = true;
		this.scale.pageAlignVertically = true;
//		this.scale.setScreenSize(true);
		/*
			create some groups
		*/
		// group containing cards only
		group_cards = game.add.group();
		// group containing the learn buttons
		group_buttons_level = game.add.group();
		// group containing the compare buttons
		group_buttons_compare = game.add.group();
		// group containing the debug stuff
		group_debug = game.add.group();
	
		// information about the game of pai-gow
		var btn_info = createButton('info',fnGameInfo);
		btn_info.x = 10;
		btn_info.y = 10;
		
		// learn how to play pai-gow
		var btn_learn = createButton('learn',fnGameLearn);
		btn_learn.x = 120;
		btn_learn.y = 10;

		// practice by setting random hands
		var btn_practice = createButton('practice',fnGamePractice);
		btn_practice.x = 230;
		btn_practice.y = 10;
		
		// practice comparing hands
		var btn_compare = createButton('compare',fnGameCompare);
		btn_compare.x = 340;
		btn_compare.y = 10;

		// do a speed test
		var btn_speed = createButton('speed',fnGameSpeed);
		btn_speed.x = 450;
		btn_speed.y = 10;

		// how many hands can you read in 30 seconds
		var btn_timed = createButton('timed',fnGameTimed);
		btn_timed.x = 560;
		btn_timed.y = 10;
		
		
		// start the selected game
		btn_start = createButton('start',fnStartGame);
		btn_start.x = 10;
		btn_start.y = 250;
		btn_start.visible = false;
		// next hand in the series
		btn_next = createButton('next',fnNextHand);
		btn_next.x = 10;
		btn_next.y = 250;
		btn_next.visible = false;
		// example (used in learn mode)
		btn_example = createButton('example',fnShowExample);
		btn_example.x = 560;
		btn_example.y = 250;
		btn_example.visible = false;
		
		// comparison buttons
		btn_win = createButton('win',fnCompareHand);
		btn_win.name = 'win';
		btn_win.x = 250;
		btn_win.y = 250;
		group_buttons_compare.add(btn_win);
		btn_lose = createButton('lose',fnCompareHand);
		btn_lose.name = 'lose';
		btn_lose.x = 380;
		btn_lose.y = 250;
		group_buttons_compare.add(btn_lose);
		btn_push = createButton('push',fnCompareHand);
		btn_push.name = 'push';
		btn_push.x = 510;
		btn_push.y = 250;
		group_buttons_compare.add(btn_push);
		// set everything in the group to invisible
		group_buttons_compare.setAll('visible',false);
		// hide the learn group for now
		group_buttons_compare.visible = false;
		
		// create buttons for learn mode
		var i = 0;
		var uid = 0;
		for (var key in Paigow.rules) {
			var value = Paigow.rules[key];
			var btn = createButton(key,fnLevelSelect);
			btn.main_key = key;
			btn.x = 670;
			btn.y = 40 + (30*i);
			group_buttons_level.add(btn);
			var n = 1;
			for (var sub in Paigow.rules[key]) {
				var subval = Paigow.rules[key][sub];
				var btn = createButton(sub,fnLevelSelect);
				btn.main_key = key;
				btn.sub_key = sub;
				btn.x = 670 +(n*110);
				btn.y = 40 + (30*i);
				group_buttons_level.add(btn);
				n++;
				uid++;
			}
			i++;
		}
		// set everything in the group to invisible
		group_buttons_level.setAll('visible',false);
		// hide the learn group for now
		group_buttons_level.visible = false;

		// create a text box for game related information
		var sprite = game.add.sprite(0,0);
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(INFO_BG,1);
		gfx.drawRect(0,0,650,200);
		sprite.addChild(gfx);
		// main information box
		/*
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(0x0000CC,1);
		gfx.drawRect(0,0,550,25);
		sprite.addChild(gfx);
		*/
		var style = { font: '12pt Courier', fill: INFO_TXT, align: 'left', wordWrap: false };
		var txt = 'Welcome to Da Casino (alpha 1.0)'
		main_info_box = game.add.text(0, 0, txt, style);	
		sprite.addChild(main_info_box);
		// game information box (show rules and stuff)
		/*
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(0x00CCCC,1);
		gfx.drawRect(0,25,550,90);
		sprite.addChild(gfx);
		*/
		var style = { font: '10pt Courier', fill: INFO_TXT, align: 'left', wordWrap: true, wordWrapWidth: 550 };
		var txt = 'Click a button above to begin'
		game_info_box = game.add.text(0, 25, txt, style);	
		sprite.addChild(game_info_box);
		// hand information box
		/*
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(0x00CC00,1);
		gfx.drawRect(0,120,550,80);
		sprite.addChild(gfx);
		*/
		var style = { font: '10pt Courier', fill: INFO_TXT, align: 'left', wordWrap: true, wordWrapWidth: 550 };
		var txt = '\nrule:\nbonus:\ndesc:';
		hand_info_box = game.add.text(0,120, txt, style);
		sprite.addChild(hand_info_box);
		// clock information box
		/*
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(0xCC0000,1);
		gfx.drawRect(550,0,100,70);
		sprite.addChild(gfx);
		*/
		var style = { font: '10pt Courier', fill: INFO_TXT, align: 'center', wordWrap: true, wordWrapWidth: 100 };
		var txt = 'clock'
		clock_info_box = game.add.text(600, 0, txt, style);
		clock_info_box.anchor.setTo(0.5,0);
		sprite.addChild(clock_info_box);
		// stat information box
		/*
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(0xCC00CC,1);
		gfx.drawRect(550,70,100,130);
		sprite.addChild(gfx);
		*/
		var style = { font: '10pt Courier', fill: INFO_TXT, align: 'center', wordWrap: true, wordWrapWidth: 100 };
		var txt = 'stats'
		stat_info_box = game.add.text(600, 70, txt, style);
		stat_info_box.anchor.setTo(0.5,0);
		sprite.addChild(stat_info_box);
		// place the information area
		sprite.x = 10;
		sprite.y = 40;

		// debug stuff
		var btn_debug = createButton('debug',debugCreateMultiple);
		btn_debug.x = 1420;
		btn_debug.y = 10;
	}
	/******************************************************************************************************************************************
		MAIN MENU STUFF
	******************************************************************************************************************************************/
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// game information
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameInfo() {
		// clear any cards / timers etc
		fnResetBoard();
		// hide the learn group
		group_buttons_level.visible = false;
		// hide the compare group
		group_buttons_compare.visible = false;
		// hide the start / next / example buttons
		btn_start.visible = false;
		btn_next.visible = false;
		btn_example.visible = false;
		// set the message
		main_info_box.text = 'Welcome to Da Casino (alpha 1.0)';
		// give some helpful info
		var txt = 'This is where i\'ll put information about the game of pai-gow';
		game_info_box.text = txt;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// learn some pai-gow
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameLearn() {
		// clear any cards / timers etc
		fnResetBoard();
		if (game_learn_main_level == 'mastered') {
			var txt = 'You have already mastered the game of pai-gow\n';
			txt += 'Select another option from above to continue your mastery';
			game_info_box.text = txt;
			return;
		}
		// show the learn group
		group_buttons_level.visible = true;
		// hide the start / next / example buttons
		btn_start.visible = false;
		btn_next.visible = false;
		btn_example.visible = false;
		// set the game mode
		game_mode = 'learn';
		// set the main level
		if (!game_learn_main_level) {
			game_learn_main_level = 'pai-gow';
		}
		// set the sub level
		if (!game_learn_sub_level) {
			game_learn_sub_level = 'nothing';
		}

		// main keys + index
		var main_keys = Object.keys(Paigow.rules);
		var main_index = main_keys.indexOf(game_learn_main_level);
		// sub keys + index
		var sub_keys = Object.keys(Paigow.rules[game_learn_main_level]);
		var sub_index = sub_keys.indexOf(game_learn_sub_level);

		group_buttons_level.visible = true;
		group_buttons_level.forEach(function(btn) {
			btn.visible = false;
			// this buttons key is the same or less than the main index
			if (main_keys.indexOf(btn.main_key) <= main_index) {
				// button has no sub key then show it
				if (!btn.sub_key) {
					btn.visible = true;
				}
				// this buttons sub key is the same or less than sub index
				if (sub_keys.indexOf(btn.sub_key) <= sub_index) {
					btn.visible = true;
				}
			}
		},this);

		// set the message
		main_info_box.text = 'learn how to play pai-gow';
		// give some helpful info
		var txt = 'click the \''+game_learn_sub_level+'\' button in the \''+game_learn_main_level+'\' row on your right to begin\n';
		txt += 'once the game begins, click the \'start\' button to start setting hands\n';
		txt += 'click the \'example\' button if you get stuck\n';
		game_info_box.text = txt;
		hand_info_box.text = 'progress to next level after 10 hands';
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// practice hands
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGamePractice() {
		fnResetBoard();
		// show the learn group
		group_buttons_level.visible = true;
		// show the start button, hide the next / example buttons
		btn_start.visible = true;
		btn_next.visible = false;
		btn_example.visible = false;

		game_mode = 'practice';
		
		game_practice_main_level = 'random';
		game_practice_sub_level = 'random+random';

		// show all the learn buttons
		group_buttons_level.forEach(function(btn) {
			btn.visible = true;
		},this);
		
		// set the message
		main_info_box.text = 'practice setting random hands';
		// give some helpful info
		var txt = 'click the \'start\' button to begin practicing randomized hands\n';
		txt += 'if you wish to practice a specific type of hand select it from the buttons on the right';
		game_info_box.text = txt;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// practice comparing hands
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameCompare() {
		fnResetBoard();
		// hide the learn group
		group_buttons_level.visible = false;
		// hide the start / next / example buttons
		btn_start.visible = false;
		btn_next.visible = false;
		btn_example.visible = false;

		main_info_box.text = 'practice comparing hands';
		game_info_box.text = 'coming soon';
		game_mode = 'compare';
		
		fnCompareHand();
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// speed test
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameSpeed() {
		fnResetBoard();
		// hide the learn group
		group_buttons_level.visible = false;
		// hide the start / next / example buttons
		btn_start.visible = false;
		btn_next.visible = false;
		btn_example.visible = false;

		main_info_box.text = 'read and compare hands as fast as you can';
		game_info_box.text = 'coming soon';
		game_mode = 'speed';
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// as many hands as you can
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameTimed() {
		fnResetBoard();
		// hide the learn group
		group_buttons_level.visible = false;
		// show the start button
		btn_start.visible = true;
		// hide the next / example buttons
		btn_next.visible = false;
		btn_example.visible = false;

		main_info_box.text = 'how many hands can you read in 30 seconds';
		game_mode = 'timed';
	}
	/******************************************************************************************************************************************
		GAME RELATED FUNCTIONS
	******************************************************************************************************************************************/
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// select a level
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnLevelSelect(btn) {
		// learn mode mastered then return
		if (game_learn_main_level == 'mastered') {
			return;
		}
		// practice mode so set up so it works right
		if (game_mode == 'practice') {
			if (btn.sub_key) {
				game_practice_main_level = btn.main_key;
				game_practice_sub_level = btn.sub_key
				// show the 'start' button
				btn_start.visible = true;
				// hide the 'next' button
				btn_next.visible = false;
				// hide the 'example' button
				btn_example.visible = false;
				// show the rule for this level
				game_info_box.text = 'Creating hands of type: '+game_practice_main_level+' - '+game_practice_sub_level;
			}
		}
		if (game_mode == 'learn') {
			// only do something if a sub button was clicked
			if(btn.sub_key) {
				game_learn_main_level = btn.main_key;
				game_learn_sub_level = btn.sub_key;
				// reset the hand count
				hand_count = 0;
				// show the 'start' button
				btn_start.visible = true;
				// hide the 'next' button
				btn_next.visible = false;
				// show the 'example' button
				btn_example.visible = true;
				// show the rule for this level
				game_info_box.text = Paigow.rules[game_learn_main_level][game_learn_sub_level];
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// show an example hand
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnShowExample() {
		fnResetBoard();
		game_info_box.text = Paigow.rules[game_learn_main_level][game_learn_sub_level];
		var str = game_learn_sub_level.split('+');
		var chance;
		if (str[1] == 'joker') {
			chance = 100;
		} else {
			chance = 0;
		}
		hand = Hand.create(Poker.create(game_learn_main_level,chance,str[0]));

		// solve for poker
		hand.poker = Poker.solve(hand.sorted);
		// solve for pai-gow
		hand.paigow = Paigow.solve(hand.poker);
		// loop and display the hands
		var cards = hand.shuffled;
		for (var i=0;i<hand.original.length;i++) {
			var card = Card.create({card:cards[i],clickable:false});
			if (card) {
				card.x = HAND_X+i*135;
				card.y = HAND_Y;
			}
			group_cards.add(card);
		}
		hand_info_box.text = 'hand becomes '+hand.paigow.desc+'\nclick the '+game_learn_sub_level+' button to try again';
		fnDisplayHouseWay(hand);
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// progress a level
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnLevelProgress() {
		fnResetBoard();

		game_level_complete = false;

		// main keys + index
		var main_keys = Object.keys(Paigow.rules);
		var main_index = main_keys.indexOf(game_learn_main_level);
		// sub keys + index
		var sub_keys = Object.keys(Paigow.rules[game_learn_main_level]);
		var sub_index = sub_keys.indexOf(game_learn_sub_level);
		
		// first increase sub_index by 1
		sub_index += 1;
		// sub_index over sub_key length, then increase main_index and reset sub index
		if (sub_index >= sub_keys.length) {
			main_index += 1;
			sub_index = 0;
		}
		// if main_index over length, end the game
		if (main_index >= main_keys.length) {
			fnGameOver();
			return;
		}
		// set new level stuff
		game_learn_main_level = main_keys[main_index];
		var sub_keys = Object.keys(Paigow.rules[game_learn_main_level]);
		game_learn_sub_level = sub_keys[sub_index];

		// show the proper buttons
		group_buttons_level.forEach(function(btn) {
			if (btn.main_key == game_learn_main_level && !btn.sub_key) {
				btn.visible = true;
			}
			if (btn.main_key == game_learn_main_level && btn.sub_key == game_learn_sub_level) {
				btn.visible = true;
			}
		},this);
		game_info_box.text = 'Congratultions you passed that level!\nClick the '+game_learn_sub_level+' button to continue';
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// compare 2 hands?
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnCompareHand(btn) {
		deck = Deck.create('standard',true,1);
		var hand = Hand.create(deck.splice(0,7));
		hand.poker = Poker.solve(hand.sorted);
		hand.paigow = Paigow.solve(hand.poker);
		fnDisplayHouseWay(hand);

		var hand = Hand.create(deck.splice(0,7));
		hand.poker = Poker.solve(hand.sorted);
		hand.paigow = Paigow.solve(hand.poker);
		fnDisplayBankHand(hand);
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// start a speed or timed game
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnStartGame() {
		fnResetBoard();
		// hide the start button
		btn_start.visible = false;

		// learn game then show the rule
		if (game_mode == 'learn') {
			game_info_box.text = Paigow.rules[game_learn_main_level][game_learn_sub_level];
		}
		// practice mode then show what type of hand we are going to make
		if (game_mode == 'practice') {
			game_info_box.text = 'Creating hands of type: '+game_practice_main_level+' - '+game_practice_sub_level;
		}
		// speed game create a deck for use throughout
		if (game_mode == 'speed') {
			deck = Deck.create('standard',true,1);
			clock_info_box.text = 'clock\n0';
			clock = 0;
			clockEvent = game.time.events.loop(Phaser.Timer.SECOND,updateClock,this,'up');
		}
		// timed game use a 30 second clock
		if (game_mode == 'timed') {
			clock_info_box.text = 'clock\n30';
			clock = 30;
			clockEvent = game.time.events.loop(Phaser.Timer.SECOND,updateClock,this,'down');
		}
		if (game_mode != 'learn') {
			hand_count = 0;
		}
		
		fnNextHand();
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// deal with the next hand
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnNextHand(data) {
		btn_next.visible = false;
		
		// learn mode so handle things
		if (game_mode == 'learn') {
			// 10 hands then move onto the next level
			if (hand_count > 10) {
				game_level_complete = true;
			}
			// level complete so move onto the next one
			if (game_level_complete) {
				fnLevelProgress();
				return;			
			}
		}
		
		main_info_box.text = 'click the cards you think belong in the hair';
		hand_info_box.text = '';

		// reset hand tries
		hand_tries = 0;
		// update the stat box
		fnUpdateStats();
		// increase hand count
		hand_count += 1;

		// create an array to hold chosen hair cards
		hair_chosen = [];
		// destroy the 'cards' layout
		group_cards.destroy();
		// create the 'cards' layout
		group_cards = game.add.group();
		
		// speed game then use a normal deck, otherwise just spawn hands
		if (game_mode == 'speed') {
			hand = Hand.create(deck.splice(0,7));
			if (deck.length < 7) {
				fnGameOver();
			}
		} else {
			if (game_mode == 'learn') {
				var str = game_learn_sub_level.split('+');
				var chance;
				if (str[1] == 'joker') {
					chance = 100;
				} else {
					chance = 0;
				}
				hand = Hand.create(Poker.create(game_learn_main_level,chance,str[0]));
			} else if (game_mode == 'practice') {
				var str = game_practice_sub_level.split('+');
				var chance;
				if (str[1] == 'joker') {
					chance = 100;
				} else {
					chance = 0;
				}
				if (str[1] == 'random') {
					chance = Math.random()*100;
				}
				// a specific hand to play with
				// display broken
//				var set = ["queen_club","nine_heart","eight_club","seven_club","five_club","four_heart","joker_one"];
//				hand = Hand.create(set);
				hand = Hand.create(Poker.create(game_practice_main_level,chance,str[0]));
			} else {
				var type = 'random'
				hand = Hand.create(Poker.create('random',50,'random'));
			}
		}

		// solve for poker
		hand.poker = Poker.solve(hand.sorted);
		// solve for pai-gow
		hand.paigow = Paigow.solve(hand.poker);
		fnDisplayNormalWay(hand);
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// handle selection of hair cards
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function selectHair(card,pointer) {
		// this card already selected, so unselect and remove it
		if (hair_chosen.indexOf(card) != -1) {
			card.y += 15;
			hair_chosen.splice(hair_chosen.indexOf(card),1); 
		} else {
			card.y -= 15;
			hair_chosen.push(card);
		}
		// selected 2 cards, check hair for correctness
		if (hair_chosen.length == 2) {
			checkHair(hair_chosen);
		}
		// if hair not correct we are here so unselect the first in line
		if (hair_chosen.length > 2) {
			hair_chosen[0].y += 15;
			hair_chosen.splice(0,1); 
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// check hair selection for correctness
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function checkHair(hair_chosen) {
		// chosen hair cards
		var chosen = [hair_chosen[0].key,hair_chosen[1].key];
		// actual hair cards
		var hair = hand.paigow.hair;
		// required is true by default
		var required = true;
		// hair is more than 2 cards and 1st one does not match 2nd one
		if (hair.length > 2 && Card.getName(hair[0]) != Card.getName(hair[1])) {
			if (chosen.indexOf(hair[0]) == -1) {
				required = false;
			}
		}
		if (required && (hair.indexOf(chosen[0]) != -1 && hair.indexOf(chosen[1]) != -1)) {
			var txt = 'You chose the correct hair!\n';
			txt += 'rule: '+hand.paigow.rule+'\n';
			txt += 'bonus: '+hand.paigow.bonus+'\n';
			txt += 'desc: '+hand.paigow.desc+'\n'
			// place the cards
			fnDisplayHouseWay(hand,chosen);
			hand_info_box.text = txt;
			btn_next.visible = true;
		} else {
			hand_tries++;
			fnUpdateStats();
			if (hand_tries > 5) {
				var txt = 'slow down & try reading the rule above again!\n';
				txt += '* sometimes straights / flushes sneak into hands they shouldnt *\n';
				txt += '* this is especially a problem with joker hands *';
				txt += '* will be fixed in the next few days *';
				hand_info_box.text = txt;
			} else {
				hand_info_box.text = 'Hair incorrect, try again :(';
			}
			// reset the chosen hair cards
			hair_chosen[0].y += 15;
			hair_chosen.splice(0,1); 
			hair_chosen[0].y += 15;
			hair_chosen.splice(0,1);
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// game over do stuff
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnGameOver() {
		btn_next.visible = false;
		group_cards.destroy();
		
		// learn mode then display grats and return
		if (game_mode == 'learn') {
			btn_example.visible = false;
			game_learn_main_level = 'mastered';
			game_info_box.text = 'Congratulations you have mastered the game of pai-gow!';
			hand_info_box.text = 'Wooooo!!!';
			return;
		}
		var txt = 'Game Over!!!\n';
		if (game_mode == 'timed') {
			txt += 'You got '+hand_count+' hands correct!\n\n';
		}
		txt += 'Click start to go again!';
		game_info_box.text = txt;
		hand_info_box.text = '';
		btn_start.visible = true;
	}
	/******************************************************************************************************************************************
		DISPLAY FUNCTIONS
	******************************************************************************************************************************************/
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// silly function to disply the hand normally
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnDisplayNormalWay(hand,opt){
		// destroy the 'cards' layout
		group_cards.destroy();
		// create the 'cards' layout
		group_cards = game.add.group();

		// opt is set means we are doing debug stuff
		if (opt) {
			var n = (!opt.row) ? 0 : opt.row;
			// loop and display the hands
			for (var i=0;i<hand.original.length;i++) {
				var sorted = hand.sorted;
				var card = Card.create({card:sorted[i],clickable:false});
				if (card) {
					card.x = HAND_X+i*130;
					card.y = HAND_Y+(200*n);
				}
				group_debug.add(card);
			}
			// add some information for debugging yeah baby!
			// create a text box for game related information
			var sprite = game.add.sprite(0,0);
			var gfx = game.add.graphics(0,0);
			gfx.beginFill(INFO_BG,1);
			gfx.drawRect(0,0,600,175);
			sprite.addChild(gfx);
			var style = { font: '10pt Courier', fill: INFO_TXT, align: 'left', wordWrap: true, wordWrapWidth: 600 };
			// no pai-gow info, show poker debug
//			var	str = (!hand.paigow) ? hand.poker.debug : hand.paigow.debug;
			// show both debug
			var str = '';
			if (hand.type && hand.opt) {
				str += 'created: '+hand.type+' - '+hand.opt+'\n';
			}
			str += hand.paigow.debug;
			var text = game.add.text(0,0, str, style);	
			sprite.addChild(text);
			group_debug.add(sprite);
			sprite.x = 920;
			sprite.y = HAND_Y+(200*n);
		} else {
			// no options, display normally
			var cards = hand.shuffled;
			for (var i=0;i<hand.original.length;i++) {
				var card = Card.create({card:cards[i],clickable:true,callback:selectHair});
				if (card) {
					card.x = HAND_X+i*135;
					card.y = HAND_Y;
				}
				group_cards.add(card);
			}
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// silly function to display the hand set correctly
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnDisplayHouseWay(hand,chosen) {
		// destroy the 'cards' layout
		group_cards.destroy();
		// create the 'cards' layout
		group_cards = game.add.group();

		if (chosen) {
			var extras = arrayDiff(hand.paigow.hair,chosen);
		}
		var hair = (!chosen) ? hand.paigow.hair : chosen;
		// if 1st hair is joker then reverse
		if (Card.getName(hair[0]) == 'joker') {
			hair.reverse();
		}
		// if 1st hair is lower than 2nd (due to selected)
		if (Card.getRank(hair[0]) < Card.getRank(hair[1])) {
			hair.reverse();
		}
		// setup the back
		var back;
		// default back comes from paigow data
		if (!chosen) {
			back = hand.paigow.back;
		} else {
			back = hand.paigow.back;
			// hair length is 3 so we might need to replace something in the back
			if (hand.paigow.hair.length > 2) {
				// hair bigger than 2 always means pair / trip / quad / joker so use the first hair card
				var name;
				if (Card.getName(hair[0]) == Card.getName(hair[1])) {
					name = Card.getName(hair[0]);
				} else {
					name = Card.getName(hair[1]);
				}
				// find the position of the card to replace
				for (var i=0; i<back.length;i++) {
					if (Card.getName(back[i]) == name) {
						if (extras.length > 0) {
							back[i] = extras[0];
							extras.splice(0,1);
						}
					}
				}
			}
		}
		var spacer = 190;
		var cards = hand.shuffled;
		for (var i=0;i<hand.original.length;i++) {
			var card = Card.create({card:cards[i],clickable:false});
			if (card.key == hair[0]) {
				card.x = 10;
				card.y = HAND_Y;
			}
			if (card.key == hair[1]) {
				card.x = 140;
				card.y = HAND_Y;
			}
			if (card.key == back[0]) {
				card.x = 10;
				card.y = HAND_Y+spacer;
			}
			if (card.key == back[1]) {
				card.x = 140;
				card.y = HAND_Y+spacer;
			}
			if (card.key == back[2]) {
				card.x = 270;
				card.y = HAND_Y+spacer;
			}
			if (card.key == back[3]) {
				card.x = 400;
				card.y = HAND_Y+spacer;
			}
			if (card.key == back[4]) {
				card.x = 530;
				card.y = HAND_Y+spacer;
			}
			group_cards.add(card);
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// silly function to display the bank hand
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnDisplayBankHand(hand) {

		var spacer = 190;
		var hair = hand.paigow.hair;
		var back = hand.paigow.back;;
		var cards = hand.sorted;
		for (var i=0;i<hand.original.length;i++) {
			var card = Card.create({card:cards[i],clickable:false});
			if (card.key == hair[0]) {
				card.x = 10;
				card.y = BANK_Y;
			}
			if (card.key == hair[1]) {
				card.x = 140;
				card.y = BANK_Y;
			}
			if (card.key == back[0]) {
				card.x = 10;
				card.y = BANK_Y+spacer;
			}
			if (card.key == back[1]) {
				card.x = 140;
				card.y = BANK_Y+spacer;
			}
			if (card.key == back[2]) {
				card.x = 270;
				card.y = BANK_Y+spacer;
			}
			if (card.key == back[3]) {
				card.x = 400;
				card.y = BANK_Y+spacer;
			}
			if (card.key == back[4]) {
				card.x = 530;
				card.y = BANK_Y+spacer;
			}
			group_cards.add(card);
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// update the clock
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function updateClock(dir) {
		var finish;
		var reset;
		if (dir == 'down') {
			clock -= 1;
			finish = 0;
			reset = 30;
		} else {
			clock += 1;
			finish = 30;
			reset = 0;
		}
		if (clock === finish) {
			clock = reset;
			clock_info_box.text = "done"
			game.time.events.remove(clockEvent);
			fnGameOver();
		} else {
			clock_info_box.text = 'clock\n' + clock;
		}
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// update stats
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnUpdateStats() {
		var txt = 'stats\n';
		txt += 'hands: '+hand_count+'\n';
		txt += 'tries: '+hand_tries+'\n';
		stat_info_box.text = txt;
	}
	/******************************************************************************************************************************************
		GENERIC UTILITIES
	******************************************************************************************************************************************/
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// function to create a button
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function createButton(txt,callback,arg) {
		var sprite = game.add.sprite(0,0);
		var gfx = game.add.graphics(0,0);
		gfx.beginFill(BTN_BG,1);
		gfx.drawRect(0,0,100,20);
		gfx.name = 'graphic';
		sprite.addChild(gfx);
		var style = { font: '10pt Courier', fill: BTN_TXT, align: 'center', wordWrap: true, wordWrapWidth: 100 };
		var text = game.add.text(50, 4, txt, style);	
		text.anchor.setTo(0.5,0);
		text.inputEnabled = true;
		sprite.addChild(text);
		sprite.inputEnabled = true;
		sprite.input.useHandCursor = true;
		sprite.events.onInputDown.add(callback,this,arg);
		
		return sprite;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// reset everything
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function fnResetBoard() {
		// destroy the 'debug' layout
		group_debug.destroy();
		// create the 'debug' layout
		group_debug = game.add.group();
		
		// destroy the 'cards' layout
		group_cards.destroy();
		// create the 'cards' layout
		group_cards = game.add.group();
		
		// reset the chosen hair cards
		hair_chosen = [];
		
		// reset the clock event
		if (clockEvent) {
			game.time.events.remove(clockEvent);
			clock_info_box.text = 'clock';
		}
		game_info_box.text = '';
		hand_info_box.text = '';
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// get the difference between 2 arrays
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function arrayDiff(big,small) {
		var diff = [];
		big.forEach(function(key) {
			if (-1 === small.indexOf(key)) {
				diff.push(key);
			}
		},this);
		return diff;
	}
	
	/******************************************************************************************************************************************
		DEBUG FUNCTIONS
	******************************************************************************************************************************************/
	///////////////////////////////////////////////////////////////////////////////////////////////////
	// create multiple hands of paigow
	///////////////////////////////////////////////////////////////////////////////////////////////////
	function debugCreateMultiple(sprite,pointer) {
		fnResetBoard();
		// hide the start / next / example buttons
		btn_start.visible = false;
		btn_next.visible = false;
		btn_example.visible = false;
		
		// hide the level / compare buttons
		group_buttons_level.visible = false;
		group_buttons_compare.visible = false;


		/*
		// create a shuffled deck for use in our game
		deck = Deck.create('standard',true,1);

		// show the deck
		for (var i=0;i<deck.length;i++) {
			var card = Card.create({card:deck[i]});
			group.addChild(card);
			card.x = 5+i*25;
		}
		*/
		// create some hands
		if (!DEBUG_COUNT) {
			DEBUG_COUNT = 25;
		}
		for (var n=0;n<DEBUG_COUNT;n++) {
			// create a specific type of hand
			if (!DEBUG_MAIN) {
				DEBUG_MAIN = 'random';
			}
			if (!DEBUG_SUB) {
				DEBUG_SUB = 'random';
			}
			var hand = Hand.create(Poker.create(DEBUG_MAIN,DEBUG_JOKER,DEBUG_SUB));
			main_info_box.text = 'creating '+DEBUG_COUNT+' '+DEBUG_MAIN+' - '+DEBUG_SUB+' hands';

			//**********************************************************************************************************
			//
			//	This section for hands that are not being set correctly
			//
			//
			/* FIXED
				wheel straight w/ joker
			var set = ["ace_diamond","seven_diamond","six_heart","five_heart","four_spade","two_club","joker_one"];
			*/
			// wheel straights w/joker
			/* FIXED
				not finding the joker high straight? joker,queen,10,9,8...but this would make it 9,8 straight instead of
				pair of 9, queen high straight. So this hand is correct
			var set = ["queen_heart","jack_spade","ten_club","nine_spade","nine_heart","eight_club","joker_one"];
 			*/
			/* FIXED
				reading the 6 high straight twice (due to the pairs)
			var set = ["seven_heart","six_heart","six_club","five_club","four_diamond","two_spade","joker_one"];
			*/
			/* FIXED
				this hand should be pair with a joker high straight
			var set = ["seven_diamond","six_heart","five_heart","four_club","three_diamond","three_club","joker_one"];
			*/
			/* FIXED
				this hand should be pair queen straight
				jack, 10, 9, joker, 7
			var set = ["queen_spade","queen_diamond","jack_club","ten_diamond","nine_heart","seven_heart","joker_one"];
			*/
			/* FIXED
				this hand should be pair king natural straight
			var set = ["king_club","nine_spade","eight_spade","seven_heart","six_diamond","five_club","joker_one"];
			*/
			/* FIXED
				this is broken for some reason
				should be pair queen / natural straight
				hair should contain queen-diamond, queen-heart, joker
			var set = ["queen_club","queen_diamond","jack_heart","ten_club","nine_spade","eight_diamond","joker_one"];
			*/
			/* FIXED
				incorrectly set as 9, 8 - 7 high straight (7,6,5,joker,3)
				should be pair 3 - 9 high natural straight
				bonus of straight not being set
			var set = ["nine_club","eight_diamond","seven_heart","six_club","five_diamond","three_club","joker_one"];
			*/
			/* FIXED
				incorrectly set as jack,nine - 10 high straight
				should be pair / pair 9's & jacks
				bonus of straight not being set
			var set = ["jack_heart","ten_heart","nine_heart","nine_club","eight_club","six_spade","joker_one"];
			*/
			/* FIXED
				this correctly set as pair / pair jacks & queens
				bonus of straight not being set
			var set = ["queen_diamond","jack_club","jack_diamond","ten_club","nine_club","five_heart","joker_one"];
			*/
			/* FIXED
				correctly set as this hand is pair 5, nine high straight
				needs to have the trip 5's in the hair
			var set = ["eight_heart","seven_heart","six_club","five_heart","five_club","five_diamond","joker_one"];
			*/
			/* FIXED
				bugs out 
				should be queen, jack...joker, 9, 8, 7, 6
			var set = ["queen_club", "jack_diamond", "nine_heart", "eight_spade", "seven_club", "six_club", "joker_one"];
			*/
			/* FIXED
				hand is incorrectly set 8,4 - flush
				should be set full house solvePair
			var set = ["ten_diamond","eight_spade","eight_diamond","four_spade","four_diamond","three_diamond","joker_one"];
			*/
			/* FIXED
				hand incorrectly set as 5, 4 - queen high straight flush
				should be queen 5, jack high flush (with straight-flush bonus)
			var set = ["queen_club","jack_club","ten_club","nine_club","eight_club","five_heart","four_club"];
			*/
			/* FIXED
				hand incorrectly set as jack, 6 - pair of 3
				should be pair 3 flush, with a straight-flush bonus
			var set = ["jack_club","six_club","five_club","four_club","three_heart","three_club","two_club"];
			*/
			/* FIXED
				hand correctly set as as pair 9, jack high straight flush
				bonus incorrect as 4 of a kind, should be straight flush
				description reads joker high straight flush
			var set = ["ten_spade","nine_spade","nine_heart","nine_club","eight_spade","seven_spade","joker_one"];
			*/
			/* FIXED
				hand correctly set as pair 6, 6 high straight flush
				need to remove the 6 spade from possible hair
			var set = ["six_spade","six_heart","five_spade","four_spade","three_spade","two_spade","joker_one"];
			*/
			/* FIXED
				hand incorrectly set 10,7 pair of 6
				should be 10, 6 - 7 high straight flush
			var set = ["ten_club","seven_diamond","six_spade","six_diamond","five_diamond","four_diamond","three_diamond"];
			*/
			/* FIXED
				hand correctly set, not setting as straight flush
			var set = ["eight_heart","seven_spade","six_spade","five_spade","five_diamond","four_spade","three_spade"];
			*/
			/* FIXED
				hand correctly set pair king, queen high flush
				bonus straight flush not set
			var set = ["king_club","queen_heart","jack_heart","ten_heart","nine_heart","six_heart","joker_one"];
			*/
			/* FIXED
				hand incorrectly set 7,2 - ace high flush
				should be pair 2 / pair ace (solvePair)
			var set = ["ace_heart","ten_heart","seven_club","four_heart","two_spade","two_heart","joker_one"];
			*/
			/* FIXED
				hand correctly set pair king, quad 2's
				need to put trip kings in the hair
			var set = ["king_spade","king_heart","king_club","two_heart","two_club","two_diamond","joker_one"];
			*/
			/* FIXED
				hand incorrectly set pair six, jack high straight
				should be pair jack, 10 high straight
//			var set = ["jack_diamond","ten_diamond","nine_club","eight_club","seven_diamond","six_club","joker_one"];
			*/
			/* FIXED
				hand set correctly, possible hair not correct
				should be trip queens
			var set = ["queen_heart","queen_club","queen_diamond","two_spade","two_heart","two_club","two_diamond"];
			*/
			/* FIXED
				hand set almost correctly, desc incorrect
				should be ace (joker) high flush
			var set = ["queen_club","nine_heart","nine_club","five_club","three_club","two_club","joker_one"];
			// this is almost the same thing, should put the natural in front with joker based flush behind
			var set = ["ace_spade","ace_heart","jack_spade","seven_spade","five_spade","four_spade","joker_one"];
			*/
			/*
				hand set correctly, hair incorrect
				should be five_diamond, followed by both nines (five is required)
			var set = ["jack_club","ten_club","nine_spade","nine_diamond","eight_heart","seven_heart","five_diamond"];
			*/
			/* FIXED
				hand set incorrectly
				should be pair 8 (natural) with joker based flush behind
			var set = ["king_heart","jack_heart","nine_heart","eight_spade","eight_club","six_heart","joker_one"];
			var set = ["king_heart","jack_heart","nine_heart","eight_diamond","eight_club","six_heart","five_heart"];
			*/
			/* FIXED
				hand set correctly
				should have king and both 9's in the hair
			var set = ["king_club","queen_club","jack_heart","ten_diamond","nine_heart","nine_club","eight_heart"];
			*/
			/* FIXED
				incorrectly set as 7,6 - ace (joker) high flush
				should be pair 3, ten high straight
			var set = ["ten_club","nine_club","eight_club","seven_heart","six_spade","three_club","joker_one"];
			*/
			/* FIXED
				incorrectly set as pair / pair
				should be pair 8, nine high straight (bonus: straight-flush)
			var set = ["nine_diamond","eight_diamond","eight_spade","seven_diamond","six_diamond","five_heart","joker_one"];
			*/
			/* FIXED
				hand set correctly, desc straight-flush not set
			var set = ["king_diamond","seven_spade","six_spade","five_spade","four_spade","three_spade","joker_one"];
			*/
			
			//
			//
			//
			//**********************************************************************************************************
			//
			/*
				hand contains a flush, automatic check in Poker.create() should rebuild the hand until there is no flush
			*/
//			var set = ["jack_heart","jack_diamond","ten_heart","ten_diamond","nine_heart","eight_heart","joker_one"];


			//
			//
			//
			//**********************************************************************************************************
			if (typeof set !== 'undefined') {
				var hand = Hand.create(set);
			}
			//
			//
			//
			// solve for poker
//			console.log('hand: ',n,hand);
			hand.poker = Poker.solve(hand.sorted);
//			console.log('hand poker: ',n,hand.poker)
			// solve for pai-gow
			hand.paigow = Paigow.solve(hand.poker);
//			console.log('hand paigow: ',n,hand.paigow);
			// display the hand (debug);
			fnDisplayNormalWay(hand,{debug:true,row:n});
			
			// break out of the loop if we are setting 1 hand
			if (typeof set !== 'undefined') {
				break;
			}
		}

/*		
		// match the hand to an exist card on the screen so we can move it (do this instead of creating a new one each time)
		var num = 0;
		group.forEach(function(card) {
			if (hand.indexOf(card.key) != -1) {
				card.x = 5+135*num;
				card.y = 200;
				num++;
			}
		},this);
*/
	}
	/******************************************************************************************************************
		FOLLOWING DOES NOTHING SINCE THIS IS A STATIC GAME
	******************************************************************************************************************/
	function update() {

	}

	function render() {

	}
</script>
</body>
</html>
